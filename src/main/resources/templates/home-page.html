<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <title>NightOPS Drop Framework</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" th:href="@{/style.css}"/>
    </head>
    <body>
        <header class="header">
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <div class="logo-icon"></div>
                        <span class="logo-text">NightOps Drop</span>
                    </div>
                    <nav class="nav">
                        <a href="#yukle" class="nav-link">Yükle</a>
                        <a href="#dosyalarim" class="nav-link">Dosyalarım</a>
                        <a href="#ayarlar" class="nav-link">Ayarlar</a>
                    </nav>
                </div>
            </div>
        </header>
        <main class="main">
            <section class="hero">
                <div class="container">
                    <div class="hero-card">
                        <h1 class="hero-title">NightOps Drop</h1>
                        <p class="hero-subtitle">Dosya yükleme kontrol merkezi</p><br> ~ Minter</div>
                </div>
                </div>
            </section>

            <section id="yukle" class="section">
                <div class="container">
                    <div class="card">

                        <h2 class="section-title">Dosya Yükle</h2>

                        <form method="post" enctype="multipart/form-data" action="#" class="upload-form" 
                              th:action="@{/files/upload}"
                              th:object="${dropfile}">
                            <span th:if="${message}" th:text="${message}"></span>
                            <div class="dropzone">
                                <div class="dropzone-icon"></div>
                                <label for="file-input" class="dropzone-label">
                                    Dosyayı buraya bırak ya da seç
                                </label>
                                <input type="file" name="file" id="file-input" class="file-input"  aria-label="Dosya seç">
                                <p class="dropzone-hint">Maks 20 MB</p>
                            </div>
                            <div>
                                <h3 class="subsection-title">Dosya İsmi</h3>
                                <input type="text" class="link-input" th:field="*{fileName}" 
                                       placeholder="payload.docx">
                                <span th:if="${#fields.hasErrors('fileName')}" th:errors='*{fileName}'></span>
                            </div>
                            <div>
                                <h3 class="subsection-title">Dosya Path</h3>
                                <input type="text" class="link-input" th:field="*{filePath}" placeholder="payload.docx">
                                <span th:if="${#fields.hasErrors('filePath')}" th:errors='*{filePath}'></span>
                            </div>

                            <details class="options-accordion">
                                <summary class="options-summary">İleri Seçenekler</summary>
                                <div class="options-content">
                                    <div class="option-row">
                                        <label for="single-use" class="option-label">
                                            <span>Tek kullanımlık</span>
                                            <input type="checkbox" id="single-use" th:field="*{oneTime}"  checked>
                                            <span th:if="${#fields.hasErrors('oneTime')}" th:errors='*{oneTime}'></span>
                                            <!--<span class="toggle-switch"></span>-->
                                        </label>
                                    </div>
                                    <div class="option-row">
                                        <label for="ttl" class="option-label-block">
                                            <span>Geçerlilik süresi (TTL)</span>
                                            <input type="datetime-local" id="ttl" th:field="*{timeToLive}" class="datetime-input">
                                            <span th:if="${#fields.hasErrors('timeToLive')}" th:errors='*{timeToLive}'></span>
                                        </label>
                                    </div>
                                </div>
                            </details>

                            <button type="submit" class="btn btn-primary">Yükle</button>
                        </form>

                        <div class="success-card" th:if='${success}'>
                            <div class="success-header">
                                <div class="success-icon"></div>
                                <h3 class="success-title">Hazır! Link oluşturuldu.</h3>
                            </div>
                            <div class="file-info">
                                <div class="file-info-row">
                                    <span class="file-info-label">Dosya:</span>
                                    <span class="file-info-value" th:text='${file.fileName}'></span>
                                </div>
                                <div class="file-info-row">
                                    <span class="file-info-label">Boyut:</span>
                                    <span class="file-info-value" th:text='${file.fileSize}'></span>
                                </div>
                                <div class="file-info-row">
                                    <span class="file-info-label">Kısa kod:</span>
                                    <span class="file-info-value" th:text='${file.shortCode}'></span>
                                </div>
                                <div class="file-info-row">
                                    <span class="file-info-label">Tek kullanımlık:</span>
                                    <span class="file-info-value" th:text="${file.isOneTime} ? 'Evet' : 'Degil'"></span>
                                </div>
                                <div class="file-info-row">
                                    <span class="file-info-label">Bitiş Tarihi:</span>
                                    <span class="file-info-value" th:text="${file.timeToLive}"></span>
                                </div>
                            </div>
                            <div class="link-box">
                                <label for="share-link" class="link-label">Paylaşım linki</label>
                                <input type="text" id="share-link" class="link-input" th:value="${config.domainName}+'/files/d/'+${file.shortCode}" readonly>
                                <p class="link-hint">Kopyalamak için seç & Ctrl/Cmd+C</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>



            <section id="dosyalarim" class="section">
                <div class="container">
                    <div class="card">
                        <div class="section-header">
                            <h2 class="section-title">Dosyalarım</h2>
                            <div class="filter-tabs">
                                <a href="#" class="filter-tab filter-tab-active">Tümü</a>
                                <a href="#" class="filter-tab">Aktif</a>
                                <a href="#" class="filter-tab">Süresi dolmuş</a>
                            </div>
                        </div>

                        <div class="table-wrapper">
                            <table id="dosyalarimTablosu" class="files-table">
                                <thead>
                                    <tr>
                                        <th>Dosya</th>
                                        <th>Boyut</th>
                                        <th>Eklenme Tarih</th>
                                        <th>İndirme</th>
                                        <th>Durum</th>
                                        <th>Kısa Link</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each='file : ${files}'>
                                        <td data-label="Dosya" th:text='${file.fileName}'>Y0K</td>
                                        <td data-label="Boyut"
                                            th:text="|${#numbers.formatDecimal(file.fileSize / 1000.0 / 1000.0, 1, 2)} MB|">
                                        </td>
                                        <td data-label="Tarih" th:text="${file.createdAt}"></td>
                                        <td data-label="İndirme" th:text='${file.clickedCount}'></td>
                                        <td data-label="Durum">
                                            <span th:class="${file.isActive} ? 'badge badge-success' : 'badge badge-warn'"  th:text="${file.isActive} ? 'Aktif' : 'Pasif'">Aktif</span>
                                        </td>
                                        <td data-label="Kısa Link">
                                            <input type="text" class="link-input-small" th:value="${config.domainName}+'/files/d/'+${file.shortCode}" readonly>
                                        </td>
                                        <td>
                                            <a class="btn btn-blue btn-sm" 
                                               th:href="@{/files/delete/{id}(id=${file.id})}"
                                               onclick="return confirm('Emin misin?');">
                                                Sil
                                            </a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="empty-state" style="display: none;">
                            <div class="empty-icon"></div>
                            <p class="empty-text">Henüz dosyan yok. Hemen yükle.</p>
                        </div>
                    </div>
                </div>
            </section>



            <section id="detay" class="section">
                <div class="container">
                    <div class="card">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" th:text='${clickedCount}'></div>
                                <div class="stat-label">Toplam İndirilen</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" th:text='${countPassiveDropFile}'></div>
                                <div class="stat-label">Toplam Sona eren</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="detay" class="section" th:each='file : ${files}' th:if='${file.isActive}'>
                <div class="container">
                    <div class="card">
                        <div class="detail-header">
                            <h2 class="section-title" th:text="${file.fileName}"></h2>
                            <div class="badge-group">
                                <span class="badge badge-primary" th:text="${file.isOneTime} ? 'Tek Kullanımlık' : 'Sınırlı Süre'"></span>
                                <span class="badge badge-warn" th:text="'TTL: '+${file.timeToLive}"> </span>
                            </div>
                        </div>


                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" th:text='${file.clickedCount}'>3</div>
                                <div class="stat-label">İndirilen</div>
                            </div>
                        </div>
                        <!-- Pasif Yap butonu -->
                        <div style="margin-top: 1.5rem;">
                            <form action='#' th:action='@{/files/passive/{id}(id=${file.id})}' method='post'>
                                <button class="btn btn-warn btn-sm" type="submit">Pasif Yap</button>
                            </form>
                        </div>
                    </div>
                </div>
            </section>

            <section id="ayarlar" class="section">
                <div class="container">
                    <div class="card">
                        <h2 class="section-title">Ayarlar</h2>
                        <form th:action="@{/config/save}" method="post" th:object="${config}">
                            <div class="success-header" th:if='${successConfig}'>
                                <h3 class="success-title">Ayarlar kaydedildi.</h3>
                            </div>
                            <div class="settings-group">
                                <h3 class="subsection-title">Domain İsmi</h3>
                                <input type="hidden"  th:field="*{id}">
                                <input type="text" class="link-input" placeholder="websitem.com" th:field="*{domainName}">
                                <p class="settings-hint">Domain ismi linkleri oluşturulmada kullanılacaktır. (Ex: website.com diye giriş yapınız.)</p>
                            </div>

                            <button type="submit" class="btn btn-secondary">Ayarları Kaydet</button>
                        </form>
                    </div>
                </div>
            </section>


            <section class='section'>
                <div class="container">
                    <form th:action='@{/logout}' action='#' method='POST'>
                        <input type='submit' class='btn btn-primary'  style="float:right;" value='Çıkış Yap'/>
                    </form>
                </div>
            </section>
        </main>

        <footer class="footer">
            <div class="container">
                <p class="footer-text">© 2025 NightOps Drop. Hiç bir hakkı saklı değildir.</p>
            </div>
        </footer>
        
         <script>
            document.getElementById('file-input').addEventListener('change', function (event) {
                const file = event.target.files[0];
                const label = document.querySelector('.dropzone-label');
                const hint = document.querySelector('.dropzone-hint');

                if (file) {
                    label.textContent = file.name; // Dosya adını göster
                    hint.textContent = `(${(file.size / 1024 / 1024).toFixed(2)} MB)`; // Dosya boyutunu da göster
                } else {
                    label.textContent = 'Dosyayı buraya bırak ya da seç';
                    hint.textContent = 'Maks 20 MB';
                }
            });
        </script>     

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const tabs = document.querySelectorAll(".filter-tab");
                const rows = document.querySelectorAll(".files-table tbody tr");

                tabs.forEach(tab => {
                    tab.addEventListener("click", function (e) {
                        e.preventDefault();

                        // Aktif sekmeyi değiştir
                        tabs.forEach(t => t.classList.remove("filter-tab-active"));
                        this.classList.add("filter-tab-active");

                        const filter = this.textContent.trim();

                        rows.forEach(row => {
                            const statusText = row.querySelector('[data-label="Durum"] span')?.textContent.trim();

                            // Filtreleme mantığı
                            if (filter === "Tümü") {
                                row.style.display = "";
                            } else if (filter === "Aktif" && statusText === "Aktif") {
                                row.style.display = "";
                            } else if (filter === "Süresi dolmuş" && statusText === "Pasif") {
                                row.style.display = "";
                            } else {
                                row.style.display = "none";
                            }
                        });
                    });
                });
            });
        </script>

        <script>
            $(document).ready(function () {
                $('#dosyalarimTablosu').DataTable();
            });
        </script>


    </body>
</html>
